digraph the_original {
    # TODO: merge finalizeCharacterization and updateVisitSummary?
    # PipelineTasks
    node [shape=box,style="dashed"];
    isr [label="isr\n{detector, exposure}"];
    makeWarp [label="makeWarp\n{tract, patch, visit}"];
    compareWarpAssembleCoadd [label="compareWarpAssembleCoadd\n{tract, patch, band}"];
    processCoadds [label="(coadd processing)"];
    subtractImages [label="(image subtraction)"];
    forcedPhot [label="(forced photometry)"];
    node [shape=box,style="filled,bold",fillcolor="lightsalmon"];
    calibrateImage [label="calibrateImage\n{detector, visit}"];
    consolidateVisit [label="consolidateVisit\n{visit}"];
    associateIsolatedStars [label="associateIsolatedStars\n{healpixM}"];
    solveAstrometry [label="solveAstrometry\n{instrument, healpixN}"];
    fgcm [label="(FGCM tasks)\n{instrument}"];
    modelVisitBackground [label="modelVisitBackground\n{visit}"];
    finalizeCharacterization [label="finalizeCharacterization\n{visit}"];
    finalizeAstrometry [label="finalizeAstrometry\n{instrument, healpixN}"];
    updateVisitSummary [label="updateVisitSummary\n{visit}"];
    finalizeImage [label="finalizeImage\n{detector, visit}"];
    rebuildImage [label="rebuildImage\n{detector, visit}"];
    consolidateSourceTable [label="consolidateSourceTable\n{visit}"];
    compressImage [label="compressImage\n{detector, visit}"];
    # DatasetTypes
    node [style="rounded,dashed", fillcolor="grey20"];
    postISRCCD [label="postISRCCD\n{detector, exposure}\nExposure"];
    warps [label="(various warps)\n{patch, visit}\nExposure"];
    node [style="rounded,filled", fillcolor="lightblue"];
    initial_pvi [label="initial_pvi\n{detector, visit}\nExposure"];
    initial_background [label="initial_background\n{detector,visit}\nBackground"];
    initial_source_detector [label="initial_source_detector\n{detector, visit}\nParquet"];
    initial_footprints [label="initial_footprints\n{detector, visit}\nSourceCatalog"];
    initial_visit_summary [label="initial_visit_summary\n{visit}\nExposureCatalog"];
    initial_source [label="initial_source\n{visit}\nParquet"];
    isolated_stars_source [label="isolated_stars_source\n{healpixM}\nParquet"];
    isolated_stars [label="isolated_stars\n{healpixM}\nParquet"];
    fgcm_photo_calib [label="fgcm_photo_calib\n{visit}\nExposureCatalog"];
    fgcm_transmission_atmosphere [label="fgcm_transmission_atmosphere\n{visit}\nTransmissionCurve"];
    fgcm_standard_stars [label="fgcm_standard_stars\n{healpixM}\nParquet"];
    solved_astrometry_wcs [label="solved_astrometry_wcs\n{detector,visit,healpixN}\nExposureCatalog"];
    solved_astrometry_stars [label="solved_astrometry_stars\n{healpixN}\nParquet"];
    final_characterization_summary [label="final_characterization_summary\n{visit}\nExposureCatalog"];
    final_characterization_stars [label="final_characterization_stars\n{visit}\nParquet"];
    final_astrometry_wcs [label="final_astrometry_wcs\n{detector,visit,healpixN}\nExposureCatalog"];
    final_astrometry_stars [label="final_astrometry_stars\n{healpixN}\nParquet"];
    final_visit_summary [label="final_visit_summary\n{visit}\nParquet"];
    warp_mask [label="warp_mask\n{patch, visit}\nMask"];
    pvi [label="pvi\n{detector,visit}\nExposure"];
    final_source_detector [label="final_source_detector\n{detector,visit}\nParquet"];
    node [style="rounded,filled", fillcolor="lightgreen"];
    visit_background [label="visit_background\n{visit}\nBackground"];
    source [label="source\n{visit}\nParquet"];
    compressed_pvi [label="compressed_pvi\n{detector,visit}\nExposure"];
    pvi [label="pvi\n{detector,visit}\nExposure"];
    node [style="rounded,dashed,filled", fillcolor="lightgreen"];
    raw [label="raw\n{detector, exposure}\nExposure"];
    calibs [label="(various calibrations)\n{detector?}"];
    coadds [label="(various coadds)\n{patch, band}\nExposure"];
    monster [label="monster\n{htmN}"];
    object [label="object\n{tract}\nParquet"];
    difference_image [label="(difference images)\n{tract}\nExposure"];
    forced_source [label="forced_source\n{visit}\nParquet"];
    # Connections.
    calibs -> isr;
    raw -> isr;
    isr -> postISRCCD;
    postISRCCD -> calibrateImage;
    monster -> calibrateImage;
    calibrateImage -> initial_pvi;
    calibrateImage -> initial_background;
    calibrateImage -> initial_source_detector;
    calibrateImage -> initial_footprints;
    initial_pvi -> consolidateVisit [label="components only"];
    initial_source_detector -> consolidateVisit;
    monster -> consolidateVisit;
    consolidateVisit -> initial_visit_summary;
    consolidateVisit -> initial_source;
    initial_source -> associateIsolatedStars;
    initial_visit_summary -> associateIsolatedStars;
    associateIsolatedStars -> isolated_stars_source;
    associateIsolatedStars -> isolated_stars;
    initial_visit_summary -> fgcm;
    isolated_stars -> fgcm;
    isolated_stars_source -> fgcm;
    monster -> fgcm;
    fgcm -> fgcm_photo_calib;
    fgcm -> fgcm_transmission_atmosphere;
    fgcm -> fgcm_standard_stars;
    initial_visit_summary -> solveAstrometry;
    isolated_stars -> solveAstrometry;
    isolated_stars_source -> solveAstrometry;
    monster -> solveAstrometry;
    fgcm_standard_stars -> solveAstrometry;
    solveAstrometry -> solved_astrometry_stars;
    solveAstrometry -> solved_astrometry_wcs;
    initial_pvi -> modelVisitBackground;
    fgcm_photo_calib -> modelVisitBackground;
    monster -> modelVisitBackground;
    calibs -> modelVisitBackground;
    modelVisitBackground -> visit_background;
    initial_pvi -> finalizeCharacterization;
    initial_visit_summary -> finalizeCharacterization;
    isolated_stars -> finalizeCharacterization;
    isolated_stars_source -> finalizeCharacterization;
    fgcm_standard_stars -> finalizeCharacterization;
    solved_astrometry_stars -> finalizeCharacterization;
    finalizeCharacterization -> final_characterization_summary;
    finalizeCharacterization -> final_characterization_stars;
    solved_astrometry_stars -> finalizeAstrometry;
    solved_astrometry_wcs -> finalizeAstrometry;
    final_characterization_stars -> finalizeAstrometry;
    isolated_stars -> finalizeAstrometry;
    isolated_stars_source -> finalizeAstrometry;
    monster -> finalizeAstrometry;
    fgcm_standard_stars -> finalizeAstrometry;
    finalizeAstrometry -> final_astrometry_stars;
    finalizeAstrometry -> final_astrometry_wcs;
    initial_visit_summary -> updateVisitSummary;
    initial_pvi -> updateVisitSummary;
    final_characterization_summary -> updateVisitSummary;
    final_astrometry_wcs -> updateVisitSummary;
    fgcm_photo_calib -> updateVisitSummary;
    visit_background -> updateVisitSummary;
    fgcm_transmission_atmosphere -> updateVisitSummary;
    updateVisitSummary -> final_visit_summary;
    initial_pvi -> makeWarp;
    visit_background -> makeWarp;
    final_visit_summary -> makeWarp;
    makeWarp -> warps;
    warps -> compareWarpAssembleCoadd;
    compareWarpAssembleCoadd -> coadds;
    compareWarpAssembleCoadd -> warp_mask;
    initial_pvi -> finalizeImage;
    warp_mask -> finalizeImage;
    final_visit_summary -> finalizeImage;
    visit_background -> finalizeImage;
    finalizeImage -> pvi;
    finalizeImage -> final_source_detector;
    visit_background -> rebuildImage;
    compressed_pvi -> rebuildImage [label="components and mask only"];
    postISRCCD -> rebuildImage;
    rebuildImage -> pvi;
    final_source_detector -> consolidateSourceTable;
    consolidateSourceTable -> source;
    pvi -> compressImage;
    compressImage -> compressed_pvi;
    coadds -> processCoadds;
    processCoadds -> object
    pvi -> subtractImages;
    subtractImages -> difference_images;
    difference_images -> forcedPhot;
    pvi -> forcedPhot;
    object -> forcedPhot;
    forcedPhot -> forced_source;
}
