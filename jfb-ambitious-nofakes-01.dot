digraph jfb_final_01 {
    # PipelineTasks
    node [shape=box,style="filled,bold",fillcolor="gray70"];
    isr [label="isr\n{detector, exposure}"];
    characterizeImage [label="characterizeImage\n{detector, visit}"];
    consolidateIcSrc [label="consolidateIcSrc\n{visit}"];
    consolidateVisitSummary [label="consolidateVisitSummary\n{visit}"];
    bootstrapAstrometry [label="bootstrapAstrometry\n{visit}"];
    bootstrapPhotometry [label="bootstrapPhotometry\n{visit}"];
    matchIcSrc [label="matchIcSrc\n{skypix1}"];
    fgcm [label="fgcm\n{instrument}"];
    jointcal [label="jointcal\n{skypix2}"];
    prepRevisit [label="prepRevisit\n{skypix3}"];
    extractRevisit [label="extractRevisit\n{detector, visit}"];
    fitRevisitPsf [label="fitRevisitPsf\n{visit}"];
    fitRevisitBackground [label="fitRevisitBackground\n{visit}"];
    planCoaddition [label="planCoaddition\n{tract, band}"];
    makeComparisonWarp [label="makeComparisonWarp\n{visit, patch}"];
    compareWarpAssembleCoadd [label="compareWarpAssembleCoadd\n{patch, band}"];
    finishVisitImage [label="finishVisitImage\n{detector, visit}"];
    consolidateSrc [label="consolidateSrc\n{visit}"];
    matchSrc [label="matchSrc\n{skypix4}"];
    fitSrcMatchAstrometry [label="fitSrcMatchAstrometry\n{skypix4}"];

    # DatasetTypes
    node [style="rounded,filled", fillcolor="gray90"];
    raw [label="raw\n{detector, exposure}\nExposure"];
    detrended [label="detrended\n{detector, exposure}\nExposure"];
    ic_pvi [label="ic_pvi\n{detector, visit}\nExposure"];
    ic_pvi_bkg [label="ic_pvi_bkg\n{detector,visit}\nBackground"];
    ic_src_detector [label="ic_src_detector\n{detector, visit}\nDataFrame"];
    ic_src [label="ic_src\n{visit}\nDataFrame"];
    ic_visit_summary [label="ic_visit_summary\n{visit}\n{ExposureCatalog}"];
    initial_wcs [label="initial_wcs\n{visit}\nExposureCatalog[SkyWcs]"];
    ic_src_initial_coords [label="ic_src_initial_coords\n{visit}\nDataFrame"];
    initial_photo_calib [label="initial_photo_calib\n{visit}\nExposureCatalog[PhotoCalib]"];
    ic_src_initial_fluxes [label="ic_src_initial_fluxes\n{visit}\nDataFrame"];
    ic_src_match [label="ic_src_match\n{skypix1}\nDataFrame"];
    ic_src_match_join [label="ic_src_match_join\n{skypix1, visit}\nDataFrame"];
    ic_src_match_fluxes [label="ic_src_match_fluxes\n{skypix1}\nDataFrame"];
    pvi_photo_calib [label="pvi_photo_calib\n{visit}\nExposureCatalog[PhotoCalib]"];
    pvi_wcs [label="pvi_wcs\n{skypix2,visit}\nExposureCalib[SkyWcs]"];
    ic_src_match_coords [label="ic_src_match_coords\n{skypix2}\nDataFrame"];
    revisit_targets [label="revisit_targets\n{skypix3}\nDataFrame"];
    revisit_psf_data [label="revisit_psf_data\n{detector, visit}\n(?)"];
    revisit_bkg_data [label="revisit_bkg_data\n{detector, visit}\n(?)"];
    pvi_psf [label="pvi_psf\n{visit}\n(?)"];
    revisit_bkg_model [label="revisit_bkg_model\n{visit}\nBackground"];
    coadd_plan [label="coadd_plan\n{tract, band}\n(?)"];
    comparison_warp [label="comparison_warp\n{visit, patch}\nExposure"];
    comparison_mask [label="comparison_mask\n{visit, patch}\nMask"];
    comparison_bkg [label="comparison_bkg\n{visit, patch}\nBackground"];
    pvi [label="pvi\n{detector, visit}\nExposure"];
    src_detector [label="src_detector\n{detector, visit}\nDataFrame"];
    src [label="src\n{visit}\nDataFrame"];
    src_match [label="src_match\n{skypix4}\nDataFrame"];
    src_match_join [label="src_match\n{skypix4, visit}\nDataFrame"];
    src_match_coords [label="src_match_coords\n{skypix4}\nDataFrame"];

    # Connections
    raw -> isr;
    isr -> detrended;
    detrended -> characterizeImage;
    characterizeImage -> ic_pvi;
    characterizeImage -> ic_pvi_bkg;
    characterizeImage -> ic_src_detector;
    ic_src_detector -> consolidateIcSrc;
    consolidateIcSrc -> ic_src;
    ic_pvi -> consolidateVisitSummary;
    consolidateVisitSummary -> ic_visit_summary;
    ic_src -> bootstrapAstrometry;
    bootstrapAstrometry -> initial_wcs;
    bootstrapAstrometry -> ic_src_initial_coords;
    ic_src -> bootstrapPhotometry;
    bootstrapPhotometry -> initial_photo_calib;
    bootstrapPhotometry -> ic_src_initial_fluxes;
    ic_src_initial_coords -> matchIcSrc;
    matchIcSrc -> ic_src_match_join;
    matchIcSrc -> ic_src_match;
    initial_photo_calib -> fgcm;
    ic_src_match -> fgcm;
    ic_src_match_join -> fgcm;
    ic_src_initial_fluxes -> fgcm;
    ic_visit_summary -> fgcm;
    fgcm -> ic_src_match_fluxes;
    fgcm -> pvi_photo_calib;
    initial_wcs -> jointcal;
    ic_visit_summary -> jointcal;
    ic_src_match -> jointcal;
    ic_src_match_fluxes -> jointcal;
    jointcal -> pvi_wcs;
    jointcal -> ic_src_match_coords;
    ic_src_match_fluxes -> prepRevisit;
    ic_src_match_coords -> prepRevisit;
    prepRevisit -> revisit_targets;
    revisit_targets -> extractRevisit;
    ic_pvi -> extractRevisit;
    ic_pvi_bkg -> extractRevisit;
    extractRevisit -> revisit_psf_data;
    extractRevisit -> revisit_bkg_data;
    revisit_psf_data -> fitRevisitPsf;
    revisit_bkg_data -> fitRevisitBackground;
    fitRevisitPsf -> pvi_psf;
    fitRevisitBackground -> revisit_bkg_model;
    ic_visit_summary -> planCoaddition;
    pvi_wcs -> planCoaddition;
    pvi_photo_calib -> planCoaddition;
    planCoaddition -> coadd_plan;
    coadd_plan -> makeComparisonWarp;
    ic_pvi -> makeComparisonWarp;
    revisit_bkg_model -> makeComparisonWarp;
    makeComparisonWarp -> comparison_warp;
    comparison_warp -> compareWarpAssembleCoadd;
    compareWarpAssembleCoadd -> comparison_mask;
    compareWarpAssembleCoadd -> comparison_bkg;
    comparison_mask -> finishVisitImage;
    comparison_bkg -> finishVisitImage;
    ic_pvi -> finishVisitImage;
    revisit_bkg_model -> finishVisitImage;
    pvi_psf -> finishVisitImage;
    pvi_wcs -> finishVisitImage;
    pvi_photo_calib -> finishVisitImage;
    finishVisitImage -> pvi;
    finishVisitImage -> src_detector;
    src_detector -> consolidateSrc;
    consolidateSrc -> src;
    src -> matchSrc;
    matchSrc -> src_match;
    matchSrc -> src_match_join;
    src_match -> fitSrcMatchAstrometry;
    src_match_join -> fitSrcMatchAstrometry;
    pvi_wcs -> fitSrcMatchAstrometry;
    fitSrcMatchAstrometry -> src_match_coords;
}
